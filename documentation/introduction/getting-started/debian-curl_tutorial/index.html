<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Debian cURL tutorial - Quartermaster - Documentation</title>
<meta name="description" content="QMSTR creates an integrated Open Source toolchain that implements industry best practises of license compliance management.">
<meta name="generator" content="Hugo 0.55.0" />
<link href="https://qmstr.org/documentationindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://qmstr.org/documentation/introduction/getting-started/debian-curl_tutorial/">
<link rel="stylesheet" href="https://qmstr.org/documentation/css/theme.min.css">


<link rel="stylesheet" href="https://qmstr.org/documentationcss/qmstr.css">


<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://qmstr.org/documentation/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://qmstr.org/documentation/js/functions.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://qmstr.org/documentation/js/jquery.backtothetop/jquery.backtothetop.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-40601155-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-40601155-2');
</script>
</head>
<body>
<div class="container"><header>
<h1>Quartermaster - Documentation</h1>

<p class="description">QMSTR creates an integrated Open Source toolchain that implements industry best practises of license compliance management.</p>

</header>
<div class="menu">
<nav>
<ul>
<li><a href="https://qmstr.org/documentation/">Documentation</a></li>
<li><a href="https://qmstr.org">Main Website</a></li>
<li><a href="https://github.com/QMSTR">Repositories</a></li>
<li><a href="https://twitter.com/fosscompliance">Twitter</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>Debian cURL tutorial</h1>

<h2 id="step-0-making-sure-your-software-builds">Step 0: Making sure your software builds</h2>

<p>This tutorial will use the debian curl library as the project under analysis.
Let&rsquo;s retrieve the debian curl source code first, in a specific revision
that we know works with this tutorial:</p>

<pre><code>&gt; cd doc/content/introduction/getting-started/debian-curl_tutorial
&gt; git clone -b stretch https://salsa.debian.org/debian/curl.git
...
&gt; cd curl
&gt; git reset --hard stretch
...
&gt; cd ..
</code></pre>

<p>In order to build debian cURL, some extra dependencies are needed.
You can run the <a href="dependencies.sh">dependencies script</a> to make sure
your environment includes all necessary dependencies:</p>

<pre><code>&gt; sudo ./dependencies.sh
...
</code></pre>

<p>All debian curl specific parts of the build have been automated in a <a href="build.sh">build
script</a>. Let&rsquo;s run it to make sure our environment is configured
to build debian cURL from scratch:</p>

<pre><code>&gt; ./build.sh
...
</code></pre>

<p>This is going to take a while..
If this works, wonderful. If not, please dig into the output and check
for errors. Quartermaster tracks what sources are compiled and what
targets are linked in your project. To be sure that everything gets
compiled again after instrumentation, let&rsquo;s clean the repository:</p>

<pre><code>&gt; cd curl
&gt; git clean -ffxd
...
&gt; cd ..
</code></pre>

<h2 id="step-1-start-a-quartermaster-master-process">Step 1: Start a Quartermaster master process</h2>

<p>Every build that is instrumented with Quartermaster needs a master
process. Every Quartermaster master needs a configuration file,
usually called <a href="qmstr.yaml">qmstr.yaml</a>. The configuration
file is located in the tutorial/ directory because in our case, we are
avoiding to make changes to the project under analysis. If you want
to learn how to fill in the configuration file, visit the <a href="../../../configuration/_index.md">qmstr.yaml instructions</a>.
Let&rsquo;s start the master:</p>

<pre><code>&gt; eval `qmstrctl start --wait --config qmstr.yaml`
</code></pre>

<p>The <code>wait</code> flag makes sure that the command returns only after the
master has finished starting up and is fully operational. The <code>config</code>
flag points to the configuration file. If it is not specified,
<code>qmstrctl</code> looks for a file called <code>qmstr.yaml</code> in  the current
directory.</p>

<p>And create the debian curl package in the database:</p>

<pre><code>&gt; qmstrctl create package:curl_7.64.0-3_amd64.deb --version $(cd curl &amp;&amp; git describe --tags --dirty --long)
</code></pre>

<h2 id="step-2-build-this-time-under-instrumentation">Step 2: Build (this time under instrumentation)</h2>

<p>For C based builds, Quartermaster modifies the environment in a way
that it can trace the calls to the compiler and linker. This
instrumentation is build-system specific. The details of how build
system instrumentation works are beyond this tutorial. Thankfully,
Quartermaster comes with a tool that automates the necessary tweaks to
the shell environment. It modifies the environment for the command it
executes, and then resets it again before exiting. In the next step,
we will use this tool to call the build script from step 0 (above):</p>

<pre><code>&gt; qmstr run ./build.sh
...
</code></pre>

<p>This script performs the same configure and build process as before,
but this time with Quartermaster instrumentation. The master receives
the build information and constructs a build graph that is later used
for analysis and reporting.  Note that the project under analysis is
completely unchanged, including the build system and configuration
files.</p>

<p>After the <a href="build.sh">build script</a> has finished successfully run the
<a href="targets.sh">targets script</a> to connect the targets, that have been
created while building debian curl, to the debian curl package:</p>

<pre><code>&gt; ./targets.sh
</code></pre>

<h2 id="step-3-analysis">Step 3: Analysis</h2>

<p>The configuration file lists a number of modules in the <code>package/analysis:</code>
section. Each of these modules are individual programs that are
shipped and installed with the master, and extend the build graph with
additional information. Usually, an individual analyzer performs a
small set of very specific tasks. The <code>git-analyzer</code> extracts the
current revision and other metadata from the repository of the project
under analysis. The <code>spdx-analyzer</code> scans input files and package
manifests for project metadata in SPDX format. The
<code>scancode-analyzer</code> identifies licenses and authors of the source
files. Most of this functionality is provided by existing
tools. Quartermaster avoids implementing features that already exist,
like a license scanner. Instead, it provides the glue code to
integrate these tools into the Quartermaster workflow and knowledge
graph. The modules mentioned above are shipped with Quartermaster. It
is however possible and intended to implement custom modules. This
will be explained in a later tutorial.</p>

<pre><code>&gt; qmstrctl analyze
...
</code></pre>

<p>The master will execute the configured analysis modules in the order
they are specified. Depending on the selected modules, this step may
take a while. All analysis results are stored within the master by
augmenting and extending the build graph generated in earlier
steps. This way, a combined picture of dynamic build-time analysis and
the results of the analyzers is created that serves as the input for
the reporters.</p>

<h2 id="step-4-reporting">Step 4: Reporting</h2>

<p>Similarly to analyzers, reporters are configured in the
<code>package/reporting:</code> section of the configuration file. While analysis
refers to any action that augments the knowledge graph with additional
information, the graph is not allowed to change anymore during
reporting, it is frozen. Any functionality that processes the
information in the knowledge graph and performs some action based on
it is considered a report. A reporter may create output files, or
submit messages to an IRC channel, or interact with an issue tracker.</p>

<pre><code>&gt; qmstrctl report
...
</code></pre>

<p>Again, the master executes the configured reporters in order.</p>

<h2 id="step-5-shutting-down-the-master">Step 5: Shutting down the master</h2>

<p>The life span of the master roughly matches that of the build
itself. The master is started right before the build is performed, and
should under normal circumstances be shut down after the build is
finished.</p>

<pre><code>&gt; qmstrctl quit
...
</code></pre>

<p>The <code>quit</code> command makes the reporting results available in the
<code>qmstr</code> subdirectory of the build directory (a different location may
be specified in the configuration file):</p>

<pre><code>&gt; ls qmstr/qmstr-reporter-html/Public_HTML_Reports/qmstr-reports.tar.bz2
qmstr/qmstr-reporter-html/Public_HTML_Reports/qmstr-reports.tar.bz2

&gt; ls qmstr/package-manifest-reporter/Package_manifest_Reporter/curl_7.64.0-3_amd64.deb.spdx
qmstr/package-manifest-reporter/Package_manifest_Reporter/curl_7.64.0-3_amd64.deb.spdx
</code></pre>

<p>Once the master is shut down, all data that it collected during the
build and analysis phases is destroyed. Any information that is
needed in later stages has to be &ldquo;reported&rdquo; as a build artifact by one
of the reporting modules.</p>

<h2 id="strep-6-validate-manifest">Strep 6: Validate manifest</h2>

<p>Validate the generated manifest(generated from the package-manifest-reporter)
against the debian curl package.</p>

<pre><code>&gt; qmstr validate curl_7.64.0-3_amd64.deb qmstr/package-manifest-reporter/Package_manifest_Reporter/curl_7.64.0-3_amd64.deb.spdx
Validation successful!
</code></pre>

<p>The validate command verifies the content of packages against the
compliance manifest and answers three questions:</p>

<pre><code>1. Does the manifest match the package? The manifest matches the package if the checksums
for the files contained in the package match the information in the manifest. This check
will fail, for example, if a binary has been changed or rebuilt after the documentation
was created so that the checksums do not match.
2. Does the package only contain files that are documented? This test will fail if there are
files in the package that are not described in the manifest.
3. Is the documentation complete? The manifest is complete if it describes all files in the
package and contains all required information about these files. This check will fail,
for example, if license or authorship information is missing even though the file is listed
in the manifest.
</code></pre>
<div class="edit-meta">Last updated on 1 Jan 0001
<br></div><nav class="pagination"><a class="nav nav-prev" href="https://qmstr.org/documentation/introduction/getting-started/" title="Getting started"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Getting started</a>
<a class="nav nav-next" href="https://qmstr.org/documentation/introduction/getting-started/json-c_tutorial/" title="JSON-C tutorial">Next - JSON-C tutorial <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer></footer>
</main><div class="sidebar">
<nav>
<ul>
<li class=""><a href="https://qmstr.org/documentation">Home</a></li>

<li class="parent"><a href="https://qmstr.org/documentation/introduction/">Introduction</a>
<ul class="sub-menu">
<li class=""><a href="https://qmstr.org/documentation/introduction/what-is-qmstr/">What is QMSTR?</a></li>
<li class=""><a href="https://qmstr.org/documentation/introduction/why-qmstr/">Why QMSTR?</a></li>

<li class=""><a href="https://qmstr.org/documentation/introduction/installation/">Installing Quartermaster</a>
</li>

<li class="parent"><a href="https://qmstr.org/documentation/introduction/getting-started/">Getting started</a>
<ul class="sub-menu">

<li class="parent active"><a href="https://qmstr.org/documentation/introduction/getting-started/debian-curl_tutorial/">Debian cURL tutorial</a>
</li>

<li class=""><a href="https://qmstr.org/documentation/introduction/getting-started/json-c_tutorial/">JSON-C tutorial</a>
</li>
</ul>
  
</li>
</ul>
  
</li>

<li class=""><a href="https://qmstr.org/documentation/qmstr-basics/">Quartermaster Basics</a>
<ul class="">

<li class=""><a href="https://qmstr.org/documentation/qmstr-basics/qmstr-cli/">Managing Nodes</a>
<ul class="">

<li class=""><a href="https://qmstr.org/documentation/qmstr-basics/qmstr-cli/database_cmds/">Database commands</a>
<ul class="">

<li class=""><a href="https://qmstr.org/documentation/qmstr-basics/qmstr-cli/database_cmds/create/">Create command</a>
</li>

<li class=""><a href="https://qmstr.org/documentation/qmstr-basics/qmstr-cli/database_cmds/describe/">Describe command</a>
</li>

<li class=""><a href="https://qmstr.org/documentation/qmstr-basics/qmstr-cli/database_cmds/delete/">Delete command</a>
</li>
</ul>
  
</li>
</ul>
  
</li>

<li class=""><a href="https://qmstr.org/documentation/qmstr-basics/connections/">Connections between nodes</a>
</li>
<li class=""><a href="https://qmstr.org/documentation/qmstr-basics/labels/">Node labels in Quartermaster</a></li>
</ul>
  
</li>

<li class=""><a href="https://qmstr.org/documentation/configuration/">Configuration</a>
</li>

<li class=""><a href="https://qmstr.org/documentation/developer/">For Developers</a>
<ul class="">
<li class=""><a href="https://qmstr.org/documentation/developer/how-to-participate/">How to participate</a></li>
<li class=""><a href="https://qmstr.org/documentation/developer/dev-environment/">Development environment</a></li>
</ul>
  
</li>

<li class=""><a href="https://qmstr.org/documentation/reference/">Command line reference</a>
<ul class="">
<li class=""><a href="https://qmstr.org/documentation/reference/qmstr/">qmstr</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstr_dev-generate-reference/">qmstr dev-generate-reference</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstr_run/">qmstr run</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstr_validate/">qmstr validate</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl/">qmstrctl</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_add-graph/">qmstrctl add-graph</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_analyze/">qmstrctl analyze</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_clean/">qmstrctl clean</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_connect/">qmstrctl connect</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_copy/">qmstrctl copy</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_create/">qmstrctl create</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_create_file/">qmstrctl create file</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_create_package/">qmstrctl create package</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_create_project/">qmstrctl create project</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_delete/">qmstrctl delete</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_describe/">qmstrctl describe</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_dev-generate-reference/">qmstrctl dev-generate-reference</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_disconnect/">qmstrctl disconnect</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_logs/">qmstrctl logs</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_quit/">qmstrctl quit</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_report/">qmstrctl report</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_snapshot/">qmstrctl snapshot</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_spawn/">qmstrctl spawn</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_start/">qmstrctl start</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_status/">qmstrctl status</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_update/">qmstrctl update</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_update_file/">qmstrctl update file</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_update_package/">qmstrctl update package</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_update_project/">qmstrctl update project</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_version/">qmstrctl version</a></li>
<li class=""><a href="https://qmstr.org/documentation/reference/qmstrctl_wait/">qmstrctl wait</a></li>
</ul>
  
</li>

<li class=""><a href="https://qmstr.org/documentation/wip/">Work in progress</a>
<ul class="">

<li class=""><a href="https://qmstr.org/documentation/wip/android-support/">Support for Android Application (apk) builds</a>
</li>

<li class=""><a href="https://qmstr.org/documentation/wip/validation/">The QMSTR Validator</a>
</li>

<li class=""><a href="https://qmstr.org/documentation/wip/self-contained-modules/">Towards self-contained modules</a>
</li>
</ul>
  
</li>
</ul>
</nav>


<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
